//  Hey there! Trying to check out my code?
//  See this project on Github: at http://github.com/mperrotti/mperrotti.com
var WorkModule={init:function(){this.collapseAllProjects();this.createProjArray();this.showAllProjects();this.workNavigation();this.moveWithScroll();OBC.susyOffCanvasToggle.init($('a[href="#show-info"]'))},collapseAllProjects:function(){$("#work").find(".is-expanded").removeClass("is-expanded").addClass("is-thumb");$("body").removeClass("is-expanded-view").removeClass("is-expanded-view-single").removeClass("is-expanded-view-all")},createProjArray:function(){$("#work").find(".grid-item").each(function(){var e=$(this).attr("id");$.inArray(e,projects)===-1&&projects.push(e)})},showAllProjects:function(){var e=function(){$("#work").find(".is-thumb").toggleClass("is-thumb").toggleClass("is-expanded");$("body").addClass("is-expanded-view").addClass("is-expanded-view-all").removeClass("is-expanded-view-single");var e=$("#work").find(".grid-item").map(function(){var e=$(this),t=e.attr("id");if(!$.trim(e.find(".grid-item__expanded-content").html()).length)return $.ajax({url:"work/"+t+".html",success:function(t){e.find(".grid-item__expanded-content").html(t)}})})};window.location.hash==="#all-projects"&&e();$('a[href="#all-projects"]').on("click",function(){e()});$('a[href="#collapse-projects"]').on("click",function(e){e.preventDefault();WorkModule.collapseAllProjects()});$(document).keydown(function(e){if(e.keyCode===27){e.preventDefault();WorkModule.collapseAllProjects();window.history.pushState({state:2},"work","?page=work");$(this)=!location.hash&&location.href.slice(-1)!="#"}})},moveWithScroll:function(){function e(){$(".grid-item__expanded-content").each(function(){var e=$(this),t=e.find(".grid-item__info"),n=e.find(".close-project"),r=t.height(),i=e.find(".grid-item__images").height(),s=$(window).scrollTop(),o=s+$(window).height(),u=e.offset().top-s,a=e.offset().top+i,f=$(window).scrollTop()-e.offset().top;if(a+r>=o&&u<=s){f=f>i-r?i-r:f;f=f<=0?0:f;t.css("top",f);n.css("top",f);e.parent().find('a[href="#show-info"]').css("top",f>20?f+80:80)}})}$('a[href="#show-info"]').one("click",function(){$(".grid-item__images").on("transitionEnd transitionend webkitTransitionEnd MSTransitionEnd otransitionend",function(t){var n=t.originalEvent.propertyName;n==="width"&&e()})});$(window).scroll(function(){e()})},workNavigation:function(){function e(e,t){var n=e.parent(),r=e.attr("id"),i=projectData[r]!==undefined,s=$.trim(e.find(".grid-item__expanded-content").html()).length;!$("body.show-grid-item__info").length&&!Modernizr.touch&&$(window).width()>=1024&&$("body").addClass("show-grid-item__info");n.find(".is-expanded").removeClass("is-expanded").addClass("is-thumb");e.removeClass("is-thumb").addClass("is-expanded");n.find(".is-thumb").insertAfter(".is-expanded");t!=="load"&&(window.location.hash=r);if(!s&&!i)$.ajax({url:"work/"+r+".html",success:function(t){e.find(".grid-item__expanded-content").html(t)},complete:function(){var e=function(){$("#work").find(".is-expanded").removeClass("is-expanded").addClass("is-thumb");$("body").removeClass("is-expanded-view")};$('a[href="#collapse-projects"]').on("click",function(e){e.preventDefault();WorkModule.collapseAllProjects()})}});else if(i){e.find(".grid-item__expanded-content").html(projectData[r].projectHTML);var o=function(){$("#work").find(".is-expanded").removeClass("is-expanded").addClass("is-thumb");$("body").removeClass("is-expanded-view")};$('a[href="#collapse-projects"]').on("click",function(e){e.preventDefault();WorkModule.collapseAllProjects();window.history.pushState({state:2},"work","?page=work");$(this)=!location.hash&&location.href.slice(-1)!="#"})}}var t=0;if(window.location.hash&&window.location.hash!=="#all-projects"&&Modernizr.history){e($(window.location.hash),"load");t=$.inArray(window.location.hash.replace("#",""),projects);console.log(t);$("body").addClass("is-expanded-view-single").removeClass("is-expanded-view-all")}$(window).on("hashchange",function(){if(window.location.hash!=="#all-projects"){e($(window.location.hash),"load");t=$.inArray(window.location.hash.replace("#",""),projects)}});$(".grid-item").on("click",function(t){t||(t=window.event);var n=$(this),r=$(t.target);if(!n.hasClass("is-expanded")&&!r.is(".close-project")){$("body").addClass("is-expanded-view-single").removeClass("is-expanded-view-all");e(n,"click")}var i=$(".is-expanded").attr("id"),s=$.inArray(i,projects)});var n=$(".is-expanded").attr("id"),t=$.inArray(n,projects);$('.expanded-Proj-Nav[href="#next-proj"]').on("click",function(n){n.preventDefault();var r=t!==projects.length-1?t+1:0,i=projects[r];e($("#"+i),"click");t=t!==projects.length-1?r:0});$('.expanded-Proj-Nav[href="#prev-proj"]').on("click",function(n){n.preventDefault();var r=t!==0?t-1:projects.length-1,i=projects[r];e($("#"+i),"click");t=t!==0?r:projects.length-1});$(document).keydown(function(n){var r=t!==0?t-1:projects.length-1,i=projects[r],s=t!==projects.length-1?t+1:0,o=projects[s];n.stopImmediatePropagation();if($(this).find(".is-expanded-view-single").length&&$(".show-page-work").length){if(n.keyCode==37){e($("#"+i),"keydown");t=t!==0?r:projects.length-1;return!1}if(n.keyCode==39){e($("#"+o),"keydown");t=t!==projects.length-1?s:0;return!1}}})}},workPageLoaded=!1,workPageData="",projects=[],projectData={},OBC=function(e,t){"use strict";e.susyOffCanvasToggle={init:function(n){t(n).on("click",function(t){t.preventDefault();e.susyOffCanvasToggle.toggleClasses(this);e.susyOffCanvasToggle.toggleText(n)});return n},toggleClasses:function(e){var n=t("body"),r=t(e).attr("href");r==="#show-info"&&n.toggleClass("show-grid-item__info");if(r==="#aboutme"){var i=t('a[href="'+r+'"]').text()==="close"?"About and Contact":"close";n.toggleClass("show-about").removeClass("show-contact");t('a[href="'+r+'"]').text(i)}r==="#contactme"&&n.toggleClass("show-contact").removeClass("show-about");return n.attr("class")},toggleText:function(e){var n=t(e).filter('[href="#show-info"]'),r=t("body")}};return e}(OBC||{},jQuery),GlobalModule={init:function(){this.preloadWorkPage(0);this.getUrlVars();this.fullHeightPage();this.pageNavigation();OBC.susyOffCanvasToggle.init($(".toggler"))},fullHeightPage:function(){$(".home").css("height",window.innerHeight)},preloadWorkPage:function(e){switch(e){case 0:$.ajax({url:"work.html",async:!0,success:function(e){$(e).find(".grid-item").each(function(){var e=$(this).attr("id");$.inArray(e,projects)===-1&&projects.push(e)})},complete:function(e){workPageLoaded=!0;workPageData=e.responseText;GlobalModule.preloadWorkPage(1);$("#work").html(workPageData).data("pulled","yes");WorkModule.init()}});break;case 1:$.each(projects,function(e,t){$.ajax({url:"work/"+t+".html",success:function(e){projectData[t]={projectHTML:e}}})})}},getUrlVars:function(){var e=[],t,n=window.location.href.slice(window.location.href.indexOf("?")+1).split("&");for(var r=0;r<n.length;r++){t=n[r].split("=");e.push(t[0]);e[t[0]]=t[1]}return e},pageChange:function(e){var t=$("#home").height(),n=$("#work").height(),r=$("#about").height();if(window.location.hash){var i=e.split("#");e=i[0];projectID=i[1]}var s=History.getState();if($("#"+e).hasClass("is-active"))return;if($("#"+e).data("pulled")==="yes"&&e!=="work"||!workPageLoaded)$.ajax({url:e+".html",success:function(t){$("#"+e).html(t).data("pulled","no")},complete:function(){WorkModule.init()}});else if(e==="work"&&workPageLoaded&&$("#work").data("pulled")==="yes"){$("#work").html(workPageData).data("pulled","no");WorkModule.init()}e==="home"&&$('a[href="#home"]').parent("li").hide();$("nav li a[href=#"+e+"]").parent().hide();e==="work"?$('nav li a[href="#home"]').parent().show():e==="home"&&$('nav li a[href="#work"]').parent().show();var o=$("body"),u=o.attr("class").split(/\s+/),a=/^show-page-/,f=parseInt(window.innerWidth*-1+$(".main-nav").width(),10);for(var l=0;l<u.length;l++){var c=u[l];c.match(a)&&o.removeClass(c+" show-about").addClass("show-page-"+e).find("#"+e).addClass("is-active")}$("section").not("#"+e).removeClass("is-active");$('a[href="#aboutme"]').text()==="close"&&$('a[href="#aboutme"]').text("About and Contact");if(e!=="home"){$("body").css("max-height","none");$(".main-nav").css({transform:"translateX("+f+"px)","-ms-transform":"translateX("+f+"px)","-webkit-transform":"translateX("+f+"px)","-o-transform":"translateX("+f+"px)","-moz-transform":"translateX("+f+"px)"});$("#work").css({transform:"translateX(0)","-ms-transform":"translateX(0)","-webkit-transform":"translateX(0)","-o-transform":"translateX(0)","-moz-transform":"translateX(0)"});var h=function(){var e={};return function(t,n,r){r||(r="Wait for window resized");e[r]&&clearTimeout(e[r]);e[r]=setTimeout(t,n)}}(),p="onorientationchange"in window,d=p?"orientationchange":"resize";window.addEventListener(d,function(){$("body").height(window.innerheight)},!1);$(window).resize(function(){h(function(){f=parseInt(window.innerWidth*-1+$(".main-nav").width(),10);$(".show-page-work").find(".main-nav").css({transform:"translateX("+f+"px)","-ms-transform":"translateX("+f+"px)","-webkit-transform":"translateX("+f+"px)","-o-transform":"translateX("+f+"px)","-moz-transform":"translateX("+f+"px)"})},100,"window resized")});$("#work").one("transitionEnd transitionend webkitTransitionEnd MSTransitionEnd otransitionend",function(e){var t=e.originalEvent.propertyName;(t==="transform"||t==="-ms-transform"||t==="-webkit-transform"||t==="-o-transform"||t==="-moz-transform")&&$(".show-page-work").length&&$(this).css({transform:"translateX(0)","-ms-transform":"translateX(0)","-webkit-transform":"translateX(0)","-o-transform":"translateX(0)","-moz-transform":"translateX(0)"})})}if(e!=="work"){$("body").css({"max-height":window.innerHeight});$(".main-nav").css({transform:"translateX(0)","-ms-transform":"translateX(0)","-webkit-transform":"translateX(0)","-o-transform":"translateX(0)","-moz-transform":"translateX(0)"});$("#work").css({transform:"translateX(-100%)","-ms-transform":"translateX(-100%)","-webkit-transform":"translateX(-100%)","-o-transform":"translateX(-100%)","-moz-transform":"translateX(-100%)","-webkit-transition":"all .5s ease-in-out","-moz-transition":"all .5s ease-in-out","-o-transition":"all .5s ease-in-out",transition:"all .5s ease-in-out"})}},pageNavigation:function(){var e=GlobalModule.getUrlVars().page;e===undefined?GlobalModule.pageChange("home"):e!==undefined&&GlobalModule.pageChange(e);$('a[data-nav-type="page"]').on("click",function(e){var t=$(this).attr("href").replace("#","");e.preventDefault();GlobalModule.pageChange(t)});$(document).keydown(function(e){if($(".show-page-work").length&&!$(".is-expanded-view-single").length){if(e.keyCode==37){History.pushState({state:1},"home","?page=home");GlobalModule.pageChange("home");return!1}}else if($(".show-page-home").length&&!$(".is-expanded-view-single").length&&e.keyCode==39){History.pushState({state:2},"work","?page=work");GlobalModule.pageChange("work");return!1}});History.Adapter.bind(window,"statechange",function(){GlobalModule.getUrlVars().page!==undefined?GlobalModule.pageChange(GlobalModule.getUrlVars().page):GlobalModule.pageChange("home")})}};(function(){var e,t=function(){},n=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"],r=n.length,i=window.console=window.console||{};while(r--){e=n[r];i[e]||(i[e]=t)}})();(function(e,t){var n=e.History,r=n.getState(),i=$("#log");$('a[href="#home"]').on("click",function(){n.pushState({state:1},"home","?page=home")});$('a[href="#work"]').on("click",function(){n.pushState({state:2},"work","?page=work")})})(window);$(document).on("ready",function(){(function(){GlobalModule.init();WorkModule.init()})()});